<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0,minimum-scale=0.5, user-scalable=0">
		<title>è´ªåƒè›‡æ¸¸æˆ</title>
		<style type="text/css">
			h2{
				text-align: center;
			}
			#score{
				text-align: center;
				font-size: 26px ;
			} 
			#snakeMap{
				margin: 0 auto;
				border: 3px solid pink;
			}
			.row{
				height: 20px;
				/*border: 1px solid orangered;*/
			}
			.col{
				height: 20px;
				width: 20px;
				/*ä½¿ç”¨æ€ªå¼‚ç›’æ¨¡å‹*/
				box-sizing: border-box;
				border: 1px solid black;
				float: left;
			}
			.activeSnake{
				background-color: mediumspringgreen;
			}
			.food{
				background-color:green;
			}
			
		</style>
	</head>
	<body>
		<h2>è´ªåƒè›‡</h2>
		<p id="score">0</p>
		<!--è´ªåƒè›‡æ‰€èµ°è·¯å¾„åœ°å›¾-->
		<div id="snakeMap">
			
		</div>
	</body>
	<script type="text/javascript" src="js/touch-0.2.14.min.js">
		
	</script>
	<script type="text/javascript">
	    //è·å–åˆ†æ•°å¯¹è±¡
		var score = document.getElementById('score');
		//è·å–ğŸåœ°å›¾å¯¹è±¡
		var snakeMap = document.getElementById('snakeMap');
//		ä¸ºäº†çµæ´»åœ°è®¾ç½®åœ°å›¾çš„å¤§å°
//		è®¾ç½®ä¸¤ä¸ªå˜é‡,åˆ†åˆ«å­˜å‚¨åˆ—æ•°å’Œè¡Œæ•°(æ–¹æ ¼çš„ä¸ªæ•°)
      	var rowNumber = 15;//è¡Œæ•°
      	var colNumber = 10;//åˆ—æ•°
      	//è®¾ç½®åœ°å›¾çš„å®½é«˜
      	snakeMap.style.width = 20 * colNumber + 'px';
      	snakeMap.style.height = 20 * rowNumber + 'px';
      	
      	//äºŒç»´æ•°ç»„
//    	var arr1 = [
//    	[3,'longlong'],
//    	['ç‹æ˜Š',28,true,90],
//    	[34,90,'s'],
//    	[45,10,33]
//    	];
//    	//å¦‚ä½•è·å–äºŒç»´æ•°ç»„é‡Œçš„å…ƒç´ 
////    	alert(arr1[2][2]);
////å¯ä»¥é€šè¿‡forå¾ªç¯éå†å¾—åˆ°æ¯ä¸€ä¸ªå…ƒç´ 
//for (var i = 0;i < arr1.length;i++) {
////	alert(arr1[i]);
////å¾—åˆ°çš„æ˜¯äºŒç»´æ•°ç»„é‡Œçš„å…ƒç´ ï¼ˆä¸€ç»´æ•°ç»„ï¼‰
//for (var j = 0;j < arr1[i].length;j++) {
////	alert(arr1[i][j]);
//}
//}
//åˆ›å»ºä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œç”¨æ¥è®°å½•åœ°å›¾ä¸Šæ‰€æœ‰çš„divçš„ä½ç½®
var divsSnake = [];
//ä½¿ç”¨äºŒç»´æ•°ç»„çš„æ–¹å¼åˆ›å»ºåœ°å›¾
for (var i = 0;i < rowNumber;i++) {
	//åˆ›å»ºè¡Œ  div
	var rowDiv = document.createElement('div');
	//è®¾ç½®divçš„æ ·å¼
	rowDiv.className = 'row';
//	debugger;//æ·»åŠ æ–­ç‚¹è°ƒè¯•ï¼Œç¨‹åºæ‰§è¡Œåˆ°è¿™å„¿ï¼Œ
//	ä¼šè‡ªåŠ¨åœæ­¢,ç›´åˆ°ä½ ç‚¹å‡»ä¸‹ä¸€æ­¥,æ‰ä¼šç»§ç»­æ‰§è¡Œ
	//å°†è¡Œdivæ·»åŠ åˆ°wrapé‡Œ
	snakeMap.appendChild(rowDiv);
	//åˆ›å»ºä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œç”¨æ¥å­˜å‚¨ä¸€è¡Œä¸­æ¯ä¸ªå°æ–¹å—div
	var rowArr = [];
	for (var j = 0;j < colNumber;j++) {
//		debugger;
		//åˆ›å»ºæ¯ä¸€è¡Œä¸­å­˜åœ¨çš„æ–¹æ ¼
		 var colDiv = document.createElement('div');
		 //è®¾ç½®cssæ ·å¼
		 colDiv.className = 'col';
		 //æ·»åŠ åˆ°è¡Œé‡Œ
		rowDiv.appendChild(colDiv);
		//å°†å°æ–¹å—æ·»åŠ åˆ°è¡Œæ•°ç»„é‡Œ
		rowArr.push(colDiv);
	}
	//æœ€åå°†è¡Œæ•°ç»„å­˜å‚¨åˆ°äºŒç»´æ•°ç»„é‡Œ
	divsSnake.push(rowArr);
}
//åˆ›å»ºğŸ
//åˆ›å»ºä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œç”¨æ¥å­˜å‚¨è›‡èº«æ‰€å çš„div
var snakeBody = [];
for (var i = 0;i < 3;i++) {
	//è®¾ç½®ä¸åŒçš„é¢œè‰²  æ–¹å—
	divsSnake[0][i].className = 'col activeSnake';
	//è®°å½•è›‡èº«æ‰€å çš„div
//	snakeBody.push(divsSnake[0][i]);
   snakeBody[i] = divsSnake[0][i];
}
var x = 2;
var y = 0;//å­˜å‚¨è›‡å¤´çš„ä½ç½®
var scoreCount = 0;//è®°å½•åˆ†æ•°
var foodY = 0;//å­˜å‚¨é£Ÿç‰©æ‰€åœ¨è¡Œçš„ä½ç½®
var foodX = 0;//å­˜å‚¨é£Ÿç‰©æ‰€åœ¨åˆ—çš„ä½ç½®
var direction = 'right';//å­˜å‚¨è›‡ç§»åŠ¨çš„æ–¹å‘
var changeDir = true;//è®¾ç½®ç‚¹å‡»æŒ‰é”®æ˜¯å¦æ”¹å˜æ–¹å‘
var timerDelay;//è®¾ç½®ä¸€ä¸ªå»¶è¿Ÿå®šæ—¶å™¨å¯¹è±¡
//é€šè¿‡é”®ç›˜ä¸Šä¸‹å·¦å³é”®ï¼Œæ§åˆ¶è›‡ç§»åŠ¨çš„æ–¹å‘
document.onkeydown = function  (e) {
//	if (changeDir == false) {
//		return;//ç»ˆæ­¢äº‹ä»¶çš„æ‰§è¡Œ
//	}
//åˆ¤æ–­æ¡ä»¶ä¸­,changeDir ç­‰ä»·äº  changeDir == true
//       !changeDir ç­‰ä»·äº  changeDir == false
if (!changeDir) {
		return;//ç»ˆæ­¢äº‹ä»¶çš„æ‰§è¡Œ
	}
	var event = e || window.event;
	//åˆ¤æ–­å‡ ä¸ªç‰¹æ®Šæƒ…å†µï¼Œä¸ºäº†åˆç†æ€§ï¼ˆè›‡å¤´ï¼Œè›‡èº«ï¼‰
	//è›‡å‘å³ç§»åŠ¨ï¼Œè€Œä¸”ç‚¹å‡»å·¦æŒ‰é”®ï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œ
	if (direction == 'right' && event.keyCode == 37) {
		return;//ç»ˆæ­¢å‡½æ•°çš„æ‰§è¡Œ
	} else if(direction == 'left' && event.keyCode == 39){
		return;
	}else if(direction == 'top' && event.keyCode == 40){
		return;
	}else if(direction == 'bottom' && event.keyCode == 38){
		return;
	}
	switch (event.keyCode){
		case 37:{//å·¦
			direction = 'left';
			break;
		}
		case 38:{//ä¸Š
			direction = 'top';
			break;
		}
		case 39:{//å³
			direction = 'right';
			break;
		}
		case 40:{//ä¸‹
			direction = 'bottom';
			break;
		}
		default:
			break;
	}
	//ä¸ºäº†é¿å…å¿«é€Ÿå¤šæ¬¡çš„ç‚¹å‡»æ–¹å‘æŒ‰é”®ï¼ˆä¿®æ”¹æ–¹å‘ï¼‰
	//é˜²æ­¢å‡ºç°bug
	changeDir = false;
  timerDelay = setTimeout(function  () {
		changeDir = true;
	},300);
}
//è›‡çš„ç§»åŠ¨
 var timerMove = setInterval(function  () {
//	//å…³é—­å»¶è¿Ÿå™¨
//	clearTimeout(timerDelay);
////	ä¸ºäº†é˜²æ­¢ä¸‹æ¬¡ç‚¹å‡»æŒ‰é”®è§¦å‘äº‹ä»¶
//  changeDir = true;
//åˆ¤æ–­æ–¹å‘,è®¾ç½®è›‡å¤´çš„ä½ç½®
switch (direction){
	case "left":{
		x--;
		break;
	}
	case "right":{
		x++;
		break;
	}
	case "top":{
		y--;
		break;
	}
	case "bottom":{
		y++;
		break;
	}
	default:
		break;
}
//åˆ¤æ–­æ˜¯å¦game over ï¼ˆè¶…å‡ºèŒƒå›´ï¼‰
if (x < 0 || y < 0 || x >= colNumber || y >= rowNumber) {
	alert('game over');
	//å…³é—­è›‡ç§»åŠ¨çš„å®šæ—¶å™¨
	clearInterval(timerMove);
	return;//ç»ˆæ­¢å‡½æ•°çš„æ‰§è¡Œ
}
//åˆ¤æ–­è›‡å¦‚æœåœ¨åƒè‡ªå·±ï¼Œåˆ™game over
for (var i = 0;i < snakeBody.length;i++) {
	//å°†æ­¤æ—¶ç§»åŠ¨ä¹‹åçš„è›‡å¤´ä½ç½®å’Œåœ¨æ­¤
//	ä¹‹å‰çš„æ‰€æœ‰è›‡èº«æ‰€åœ¨çš„divæ¯”è¾ƒ,å¦‚æœç›¸åŒ,åˆ™è¯´æ˜
//	åƒåˆ°è›‡èº«
    if (snakeBody[i] == divsSnake[y][x]) {
    	alert('game overï¼');
    	//å…³é—­è›‡ç§»åŠ¨çš„å®šæ—¶å™¨
	clearInterval(timerMove);
    	return;
    }
}
//åˆ¤æ–­è›‡å¤´ç§»åŠ¨çš„ä½ç½®æ˜¯å¦æ˜¯é£Ÿç‰©
if (foodY == y && foodX == x) {
	
	divsSnake[foodY][foodX].className = 'col activeSnake';
	scoreCount++;
	//æ˜¾ç¤ºæ‰€å¾—åˆ†æ•°
	score.innerHTML = scoreCount;
	//æ·»åŠ è›‡å¤´ï¼ˆè›‡èº«é•¿åº¦+ä¸€æ ¼ï¼‰
	snakeBody.push(divsSnake[foodY][foodX]);
	//é‡æ–°éšæœºé£Ÿç‰©
	ranFood();
	//è›‡å¤´ç¢°åˆ°é£Ÿç‰©çš„æƒ…å†µ
//	alert('ç¢°åˆ°é£Ÿç‰©ï¼');
    //è®¾ç½®åˆ†æ•°åŠ 1
} else{
	//è›‡å¤´ç¢°ä¸åˆ°é£Ÿç‰©çš„æƒ…å†µ
	//å»æ‰è›‡å°¾é¢œè‰²
	snakeBody[0].className = 'col';
	//å»æ‰è›‡å°¾div
	//åˆ é™¤æ•°ç»„é‡Œçš„ç¬¬ä¸€ä¸ªå…ƒç´ 
	snakeBody.shift();
//	unshitf() æ·»åŠ åˆ°æ•°ç»„é‡Œçš„ç¬¬ä¸€ä¸ªå…ƒç´ ä½ç½®
//	pop()  åˆ é™¤æ•°ç»„é‡Œçš„æœ€åä¸€ä¸ªå…ƒç´ 
//	push() æ·»åŠ åˆ°æ•°ç»„é‡Œæœ€åä¸€ä¸ªå…ƒç´ 
//è®¾ç½®æ–°çš„è›‡å¤´ä½ç½®ä»¥åŠdiv
//è®¾ç½®è›‡å¤´æ‰€åœ¨çš„divé¢œè‰²
divsSnake[y][x].className = 'col activeSnake';
//æ·»åŠ æ–°çš„è›‡å¤´åˆ°æ•°ç»„é‡Œ
snakeBody.push(divsSnake[y][x]);
	
}



},300);
//éšæœºæ•°[min,max]
function randomNumber (min,max) {
return Math.floor(Math.random() * (max - min + 1) + min);
}
//éšæœºäº‹ç‰©çš„ä½ç½®
function ranFood () {
	//éšæœºè¡Œçš„ä½ç½®ä¸‹æ ‡
  foodY = randomNumber(0,rowNumber - 1);
  //éšæœºåˆ—çš„ä½ç½®ä¸‹æ ‡
  foodX = randomNumber(0,colNumber - 1);
  //å¦‚æœéšæœºå‡ºæ¥çš„é£Ÿç‰©ä½ç½®åœ¨è›‡èº«ä¸Šï¼Œåˆ™ç»§ç»­éšæœºé£Ÿç‰©
  if (divsSnake[foodY][foodX].className == 'col activeSnake') {
  	ranFood();//ç»§ç»­éšæœºé£Ÿç‰©
  } else{
  	//å°†éšæœºå‡ºçš„é£Ÿç‰©è®¾ç½®é¢œè‰²
  divsSnake[foodY][foodX].className = 'food col';
  }
}
//éšæœºå‡ºé£Ÿç‰©
ranFood();

touch.on(document, 'touchstart', function(ev){
	//ç¦æ­¢ç³»ç»Ÿè‡ªå¸¦çš„è§¦æ‘¸äº‹ä»¶
	ev.preventDefault();
});
//å¤„ç†è§¦æ‘¸äº‹ä»¶
touch.on(document, 'swiperight swipeleft swipeup swipedown', function(ev){
	var event = ev || window.event;
	//å¤„ç†ç‰¹æ®Šæƒ…å†µ
	if (direction == 'left' && event.type == 'swiperight') {
		return;
	}else if (direction == 'right' && event.type == 'swipeleft') {
		return;
	}else if (direction == 'top' && event.type == 'swipedown') {
		return;
	}else if (direction == 'bottom' && event.type == 'swipeup') {
		return;
	}
	//æ­£å¸¸é€šè¿‡è½»æ‰«æ–¹å‘å»ä¿®æ”¹ç§»åŠ¨çš„æ–¹å‘
	switch (event.type){
		case "swipeup":{
			direction = "top";
			break;
		}
		case "swipedown":{
			direction = "bottom";
			break;
		}
		case "swipeleft":{
			direction = "left";
			break;
		}
		case "swiperight":{
			direction = "right";
			break;
		}
			
		default:
			break;
	}
	
	
});

		
		
		
	</script>
</html>
